name: 'Build IoT Edge Modules'

trigger:
  branches:
    include:
      - main
  paths:
    exclude:
    - images/*
    - README.md

pool:
  vmImage: 'ubuntu-latest'

variables:
  BUILD_VERSION: '0.0.$(Build.BuildId)'

steps:
- script: pip install -U iotedgedev
  displayName: 'Install IoT Edge Dev Tool'

- script: iotedgedev build
  displayName: 'Build module images'

- publish: '$(System.DefaultWorkingDirectory)/config/deployment.amd64.json'
  artifact: 'IoTEdgeDeploymentManifest'
  displayName: 'Publish IoT Edge deployment manifest'
